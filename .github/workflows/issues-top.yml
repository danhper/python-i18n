name: Top issues action.
on:
    schedule:
        - cron: "0 0 */1 * *"

jobs:
    check:
        name: Check for open issues
        runs-on: ubuntu-latest
        permissions:
            issues: read
            contents: read
        outputs:
            has_open_issues: ${{ steps.check.outputs.result }}
        steps:
            - id: check
              name: Check open issues
              uses: actions/github-script@v6
              with:
                  script: |
                      const owner = context.repo.owner;
                      const repo = context.repo.repo;
                      const issues = await github.rest.issues.listForRepo({ owner, repo, state: 'open', per_page: 5 });
                      // Exclude pull requests â€” only count real issues
                      const hasIssue = issues.data.some(i => !i.pull_request);
                      return hasIssue ? 'true' : 'false';

    ShowAndLabelTopIssues:
        name: Display and label top issues.
        needs: check
        if: needs.check.outputs.has_open_issues == 'true'
        permissions:
            contents: read
            issues: write
            pull-requests: write
        runs-on: ubuntu-latest
        steps:
            - name: Run top issues action
              uses: rickstaa/top-issues-action@v1
              env:
                  github_token: ${{ secrets.GITHUB_TOKEN }}
              with:
                  label: true
                  dashboard: true
                  dashboard_show_total_reactions: true
                  top_issues: true
                  top_bugs: true
                  top_features: true
                  top_pull_requests: true
